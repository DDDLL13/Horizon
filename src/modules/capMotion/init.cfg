//capMotion by -Cap1taL-
//2024.11.12

//import
exec Horizon/src/modules/capMotion/keylib/keylib

//load ticker from Horizon
alias hzTicker_4999ms_capMotion "forwardback 1 0 0;rightleft 1 0 0"
alias hzTicker_9ms_capMotion "capMotTicker_tmp"
alias capMotTicker_tmp ""
alias hzTicker_inf_capMotion "capMotTicker_keyfb;capMotTicker_keyrl"
alias capMotTicker_keyfb ""
alias capMotTicker_keyrl ""
alias hzTicker_70ms_capMotion "capMotTicker_autostopfb;capMotTicker_autostoprl"
alias capMotTicker_autostopfb ""
alias capMotTicker_autostoprl ""

//joy move lib
//support custom speed, status upd
alias capMot_joyf_spd 
alias capMot_joyb_spd
alias capMot_joyr_spd
alias capMot_joyl_spd
alias capMot_joyfb  "joy_forward_sensitivity 0; alias capMot_joyfb_upd capMot_joyfb"
alias capMot_joyrl  "joy_side_sensitivity 0;    alias capMot_joyrl_upd capMot_joyrl"
alias capMot_joyf   "capMot_joyf_spd;alias capMot_joyfb_upd capMot_joyf"
alias capMot_joyb   "capMot_joyb_spd;alias capMot_joyfb_upd capMot_joyb"
alias capMot_joyr   "capMot_joyr_spd;alias capMot_joyrl_upd capMot_joyr"
alias capMot_joyl   "capMot_joyl_spd;alias capMot_joyrl_upd capMot_joyl"

alias capMot_joyfb_upd
alias capMot_joyrl_upd
alias capMot_joy_upd "capMot_joyfb_upd;capMot_joyrl_upd"

alias capMot_joy_setSpeedFull "alias capMot_joyf_spd joy_forward_sensitivity 1;alias capMot_joyb_spd joy_forward_sensitivity -1;alias capMot_joyr_spd joy_side_sensitivity 1;alias capMot_joyl_spd joy_side_sensitivity -1;capMot_joy_upd"
alias capMot_joy_setSpeedNone "alias capMot_joyf_spd joy_forward_sensitivity 0;alias capMot_joyb_spd joy_forward_sensitivity 0;alias capMot_joyr_spd joy_side_sensitivity 0;alias capMot_joyl_spd joy_side_sensitivity 0;capMot_joy_upd"

// key move lib
// use keylib
// support status upd
alias +capMot_keyf "keylib_forward_1_upd;alias capMot_keyf_upd +capMot_keyf"
alias -capMot_keyf "keylib_forward_0_upd;alias capMot_keyf_upd -capMot_keyf"
alias +capMot_keyb "keylib_back_1_upd;alias capMot_keyb_upd +capMot_keyb"
alias -capMot_keyb "keylib_back_0_upd;alias capMot_keyb_upd -capMot_keyb"
alias +capMot_keyr "keylib_right_1_upd;alias capMot_keyr_upd +capMot_keyr"
alias -capMot_keyr "keylib_right_0_upd;alias capMot_keyr_upd -capMot_keyr"
alias +capMot_keyl "keylib_left_1_upd;alias capMot_keyl_upd +capMot_keyl"
alias -capMot_keyl "keylib_left_0_upd;alias capMot_keyl_upd -capMot_keyl"

//autostop lib
// use keylib
alias capMot_autostop_f_inf "capMot_autostop_f_cmd;alias capMot_autostop_f_upd capMot_autostop_f_cmd;alias capMotTicker_keyfb"
alias capMot_autostop_b_inf "capMot_autostop_b_cmd;alias capMot_autostop_b_upd capMot_autostop_b_cmd;alias capMotTicker_keyfb"
alias capMot_autostop_r_inf "capMot_autostop_r_cmd;alias capMot_autostop_r_upd capMot_autostop_r_cmd;alias capMotTicker_keyrl"
alias capMot_autostop_l_inf "capMot_autostop_l_cmd;alias capMot_autostop_l_upd capMot_autostop_l_cmd;alias capMotTicker_keyrl"
alias capMot_autostop_f "alias capMotTicker_keyfb capMot_autostop_f_inf"
alias capMot_autostop_b "alias capMotTicker_keyfb capMot_autostop_b_inf"
alias capMot_autostop_r "alias capMotTicker_keyrl capMot_autostop_r_inf"
alias capMot_autostop_l "alias capMotTicker_keyrl capMot_autostop_l_inf"

alias capMot_autostop_upd "capMot_autostop_f_upd;capMot_autostop_b_upd;capMot_autostop_r_upd;capMot_autostop_l_upd"

alias capMot_autostop_fb_140ms "-capMot_keyf;-capMot_keyb;alias capMot_autostop_f_upd ;alias capMot_autostop_b_upd ;alias capMotTicker_autostopfb "
alias capMot_autostop_fb_70ms "alias capMotTicker_autostopfb capMot_autostop_fb_140ms"
alias capMot_autostop_fb_0ms "alias capMotTicker_autostopfb capMot_autostop_fb_70ms"
alias capMot_autostop_fb "alias capMotTicker_autostopfb capMot_autostop_fb_0ms"
alias capMot_autostop_fbclr "alias capMotTicker_autostopfb "

alias capMot_autostop_rl_140ms "-capMot_keyr;-capMot_keyl;alias capMot_autostop_r_upd ;alias capMot_autostop_l_upd ;alias capMotTicker_autostoprl "
alias capMot_autostop_rl_70ms "alias capMotTicker_autostoprl capMot_autostop_rl_140ms"
alias capMot_autostop_rl_0ms "alias capMotTicker_autostoprl capMot_autostop_rl_70ms"
alias capMot_autostop_rl "alias capMotTicker_autostoprl capMot_autostop_rl_0ms"
alias capMot_autostop_rlclr "alias capMotTicker_autostoprl "

alias capMot_autostopW_on  "alias capMot_autostop_f_cmd keylib_forward_d_upd"
alias capMot_autostopW_off "alias capMot_autostop_f_cmd "
alias capMot_autostopS_on  "alias capMot_autostop_b_cmd keylib_back_d_upd"
alias capMot_autostopS_off "alias capMot_autostop_b_cmd "
alias capMot_autostopD_on  "alias capMot_autostop_r_cmd keylib_right_d_upd"
alias capMot_autostopD_off "alias capMot_autostop_r_cmd "
alias capMot_autostopA_on  "alias capMot_autostop_l_cmd keylib_left_d_upd"
alias capMot_autostopA_off "alias capMot_autostop_l_cmd "


//joy transformation
    //status pack
    alias capMot_joyTF_fb00_sta "capMot_joyfb;  capMot_joyTF_fb00"
    alias capMot_joyTF_fb10_sta "capMot_joyf;   capMot_joyTF_fb10"
    alias capMot_joyTF_fb01_sta "capMot_joyb;   capMot_joyTF_fb01"
    alias capMot_joyTF_fb11_sta "capMot_joyfb;  capMot_joyTF_fb11"
    alias capMot_joyTF_rl00_sta "capMot_joyrl;  capMot_joyTF_rl00"
    alias capMot_joyTF_rl10_sta "capMot_joyr;   capMot_joyTF_rl10"
    alias capMot_joyTF_rl01_sta "capMot_joyl;   capMot_joyTF_rl01"
    alias capMot_joyTF_rl11_sta "capMot_joyrl;  capMot_joyTF_rl11"
alias capMot_joyTF_fb00_to10 "capMot_joyf;-capMot_keyf;capMot_autostop_fbclr;capMot_autostop_b;capMot_joyTF_fb10"
alias capMot_joyTF_fb00_to01 "capMot_joyb;-capMot_keyb;capMot_autostop_fbclr;capMot_autostop_f;capMot_joyTF_fb01"
alias capMot_joyTF_fb00 "alias +capMot_mvforward capMot_joyTF_fb00_to10;alias +capMot_mvback capMot_joyTF_fb00_to01;capMot_moveTF_fb00"
alias capMot_joyTF_fb10_to00 "capMot_joyfb;capMot_autostop_fb;capMot_joyTF_fb00"
alias capMot_joyTF_fb10_to11 "capMot_joyfb;capMot_autostop_fb;capMot_joyTF_fb11"
alias capMot_joyTF_fb10 "alias -capMot_mvforward capMot_joyTF_fb10_to00;alias +capMot_mvback capMot_joyTF_fb10_to11;capMot_moveTF_fb10"
alias capMot_joyTF_fb01_to11 "capMot_joyfb;capMot_autostop_fb;capMot_joyTF_fb11"
alias capMot_joyTF_fb01_to00 "capMot_joyfb;capMot_autostop_fb;capMot_joyTF_fb00"
alias capMot_joyTF_fb01 "alias +capMot_mvforward capMot_joyTF_fb01_to11;alias -capMot_mvback capMot_joyTF_fb01_to00;capMot_moveTF_fb01"
alias capMot_joyTF_fb11_to01 "capMot_joyb;-capMot_keyb;capMot_autostop_fbclr;capMot_autostop_f;capMot_joyTF_fb01"
alias capMot_joyTF_fb11_to10 "capMot_joyf;-capMot_keyf;capMot_autostop_fbclr;capMot_autostop_b;capMot_joyTF_fb10"
alias capMot_joyTF_fb11 "alias -capMot_mvforward capMot_joyTF_fb11_to01;alias -capMot_mvback capMot_joyTF_fb11_to10;capMot_moveTF_fb11"

alias capMot_joyTF_rl00_to10 "capMot_joyr;-capMot_keyr;capMot_autostop_rlclr;capMot_autostop_l;capMot_joyTF_rl10"
alias capMot_joyTF_rl00_to01 "capMot_joyl;-capMot_keyl;capMot_autostop_rlclr;capMot_autostop_r;capMot_joyTF_rl01"
alias capMot_joyTF_rl00 "alias +capMot_mvright capMot_joyTF_rl00_to10;alias +capMot_mvleft capMot_joyTF_rl00_to01;capMot_moveTF_rl00"
alias capMot_joyTF_rl10_to00 "capMot_joyrl;capMot_autostop_rl;capMot_joyTF_rl00"
alias capMot_joyTF_rl10_to11 "capMot_joyrl;capMot_autostop_rl;capMot_joyTF_rl11"
alias capMot_joyTF_rl10 "alias -capMot_mvright capMot_joyTF_rl10_to00;alias +capMot_mvleft capMot_joyTF_rl10_to11;capMot_moveTF_rl10"
alias capMot_joyTF_rl01_to11 "capMot_joyrl;capMot_autostop_rl;capMot_joyTF_rl11"
alias capMot_joyTF_rl01_to00 "capMot_joyrl;capMot_autostop_rl;capMot_joyTF_rl00"
alias capMot_joyTF_rl01 "alias +capMot_mvright capMot_joyTF_rl01_to11;alias -capMot_mvleft capMot_joyTF_rl01_to00;capMot_moveTF_rl01"
alias capMot_joyTF_rl11_to01 "capMot_joyl;-capMot_keyl;capMot_autostop_rlclr;capMot_autostop_r;capMot_joyTF_rl01"
alias capMot_joyTF_rl11_to10 "capMot_joyr;-capMot_keyr;capMot_autostop_rlclr;capMot_autostop_l;capMot_joyTF_rl10"
alias capMot_joyTF_rl11 "alias -capMot_mvright capMot_joyTF_rl11_to01;alias -capMot_mvleft capMot_joyTF_rl11_to10;capMot_moveTF_rl11"

//key transformation
    //status pack
    alias capMot_keyTF_fb00_sta "-capMot_keyf;-capMot_keyb;capMot_keyTF_fb00"
    alias capMot_keyTF_fb10_sta "+capMot_keyf;-capMot_keyb;capMot_keyTF_fb10"
    alias capMot_keyTF_fb01_sta "-capMot_keyf;+capMot_keyb;capMot_keyTF_fb01"
    alias capMot_keyTF_fb11_sta "-capMot_keyf;-capMot_keyb;capMot_keyTF_fb11"
    alias capMot_keyTF_rl00_sta "-capMot_keyr;-capMot_keyl;capMot_keyTF_rl00"
    alias capMot_keyTF_rl10_sta "+capMot_keyr;-capMot_keyl;capMot_keyTF_rl10"
    alias capMot_keyTF_rl01_sta "-capMot_keyr;+capMot_keyl;capMot_keyTF_rl01"
    alias capMot_keyTF_rl11_sta "-capMot_keyr;-capMot_keyl;capMot_keyTF_rl11"
alias capMot_keyTF_fb00_to10 "+capMot_keyf;capMot_autostop_fbclr;capMot_autostop_b;capMot_keyTF_fb10"
alias capMot_keyTF_fb00_to01 "+capMot_keyb;capMot_autostop_fbclr;capMot_autostop_f;capMot_keyTF_fb01"
alias capMot_keyTF_fb00 "alias +capMot_mvforward capMot_keyTF_fb00_to10;alias +capMot_mvback capMot_keyTF_fb00_to01;capMot_moveTF_fb00"
alias capMot_keyTF_fb10_to00 "-capMot_keyf;capMot_autostop_fb;capMot_keyTF_fb00"
alias capMot_keyTF_fb10_to11 "-capMot_keyf;capMot_autostop_fb;capMot_keyTF_fb11"
alias capMot_keyTF_fb10 "alias -capMot_mvforward capMot_keyTF_fb10_to00;alias +capMot_mvback capMot_keyTF_fb10_to11;capMot_moveTF_fb10"
alias capMot_keyTF_fb01_to11 "-capMot_keyb;capMot_autostop_fb;capMot_keyTF_fb11"
alias capMot_keyTF_fb01_to00 "-capMot_keyb;capMot_autostop_fb;capMot_keyTF_fb00"
alias capMot_keyTF_fb01 "alias +capMot_mvforward capMot_keyTF_fb01_to11;alias -capMot_mvback capMot_keyTF_fb01_to00;capMot_moveTF_fb01"
alias capMot_keyTF_fb11_to01 "+capMot_keyb;capMot_autostop_fbclr;capMot_autostop_f;capMot_keyTF_fb01"
alias capMot_keyTF_fb11_to10 "+capMot_keyf;capMot_autostop_fbclr;capMot_autostop_b;capMot_keyTF_fb10"
alias capMot_keyTF_fb11 "alias -capMot_mvforward capMot_keyTF_fb11_to01;alias -capMot_mvback capMot_keyTF_fb11_to10;capMot_moveTF_fb11"

alias capMot_keyTF_rl00_to10 "+capMot_keyr;capMot_autostop_rlclr;capMot_autostop_l;capMot_keyTF_rl10"
alias capMot_keyTF_rl00_to01 "+capMot_keyl;capMot_autostop_rlclr;capMot_autostop_r;capMot_keyTF_rl01"
alias capMot_keyTF_rl00 "alias +capMot_mvright capMot_keyTF_rl00_to10;alias +capMot_mvleft capMot_keyTF_rl00_to01;capMot_moveTF_rl00"
alias capMot_keyTF_rl10_to00 "-capMot_keyr;capMot_autostop_rl;capMot_keyTF_rl00"
alias capMot_keyTF_rl10_to11 "-capMot_keyr;capMot_autostop_rl;capMot_keyTF_rl11"
alias capMot_keyTF_rl10 "alias -capMot_mvright capMot_keyTF_rl10_to00;alias +capMot_mvleft capMot_keyTF_rl10_to11;capMot_moveTF_rl10"
alias capMot_keyTF_rl01_to11 "-capMot_keyl;capMot_autostop_rl;capMot_keyTF_rl11"
alias capMot_keyTF_rl01_to00 "-capMot_keyl;capMot_autostop_rl;capMot_keyTF_rl00"
alias capMot_keyTF_rl01 "alias +capMot_mvright capMot_keyTF_rl01_to11;alias -capMot_mvleft capMot_keyTF_rl01_to00;capMot_moveTF_rl01"
alias capMot_keyTF_rl11_to01 "+capMot_keyl;capMot_autostop_rlclr;capMot_autostop_r;capMot_keyTF_rl01"
alias capMot_keyTF_rl11_to10 "+capMot_keyr;capMot_autostop_rlclr;capMot_autostop_l;capMot_keyTF_rl10"
alias capMot_keyTF_rl11 "alias -capMot_mvright capMot_keyTF_rl11_to01;alias -capMot_mvleft capMot_keyTF_rl11_to10;capMot_moveTF_rl11"

//move transformation
    //status pack
    alias capMot_moveTF_fb10_revsta "-capMot_mvforward;+capMot_mvback"
    alias capMot_moveTF_fb01_revsta "-capMot_mvback;+capMot_mvforward"
    alias capMot_moveTF_rl10_revsta "-capMot_mvright;+capMot_mvleft"
    alias capMot_moveTF_rl01_revsta "-capMot_mvleft;+capMot_mvright"
    //abstract move transformation-status
    alias capMot_moveTF_fb00 "alias capMot_joyTF_fb_sta capMot_joyTF_fb00_sta;alias capMot_keyTF_fb_sta capMot_keyTF_fb00_sta;alias capMot_moveTF_fb_revsta"
    alias capMot_moveTF_fb10 "alias capMot_joyTF_fb_sta capMot_joyTF_fb10_sta;alias capMot_keyTF_fb_sta capMot_keyTF_fb10_sta;alias capMot_moveTF_fb_revsta capMot_moveTF_fb10_revsta"
    alias capMot_moveTF_fb01 "alias capMot_joyTF_fb_sta capMot_joyTF_fb01_sta;alias capMot_keyTF_fb_sta capMot_keyTF_fb01_sta;alias capMot_moveTF_fb_revsta capMot_moveTF_fb01_revsta"
    alias capMot_moveTF_fb11 "alias capMot_joyTF_fb_sta capMot_joyTF_fb11_sta;alias capMot_keyTF_fb_sta capMot_keyTF_fb11_sta;alias capMot_moveTF_fb_revsta"
    alias capMot_moveTF_rl00 "alias capMot_joyTF_rl_sta capMot_joyTF_rl00_sta;alias capMot_keyTF_rl_sta capMot_keyTF_rl00_sta;alias capMot_moveTF_rl_revsta"
    alias capMot_moveTF_rl10 "alias capMot_joyTF_rl_sta capMot_joyTF_rl10_sta;alias capMot_keyTF_rl_sta capMot_keyTF_rl10_sta;alias capMot_moveTF_rl_revsta capMot_moveTF_rl10_revsta"
    alias capMot_moveTF_rl01 "alias capMot_joyTF_rl_sta capMot_joyTF_rl01_sta;alias capMot_keyTF_rl_sta capMot_keyTF_rl01_sta;alias capMot_moveTF_rl_revsta capMot_moveTF_rl01_revsta"
    alias capMot_moveTF_rl11 "alias capMot_joyTF_rl_sta capMot_joyTF_rl11_sta;alias capMot_keyTF_rl_sta capMot_keyTF_rl11_sta;alias capMot_moveTF_rl_revsta"

alias capMot_moveTF_sw2clr "keylib_forward_0_upd;keylib_back_0_upd;keylib_right_0_upd;keylib_left_0_upd;capMot_joyfb;capMot_joyrl"
alias capMot_moveTF_sw2joy "capMot_moveTF_sw2clr;capMot_joyTF_fb_sta;capMot_joyTF_rl_sta;capMot_autostop_upd"
alias capMot_moveTF_sw2key "capMot_moveTF_sw2clr;capMot_keyTF_fb_sta;capMot_keyTF_rl_sta;capMot_autostop_upd"

// move reverse transformation
alias +capMot_prsforward 
alias -capMot_prsforward 
alias +capMot_prsback 
alias -capMot_prsback 
alias +capMot_prsright 
alias -capMot_prsright 
alias +capMot_prsleft 
alias -capMot_prsleft
alias capMot_mvrev_off_fb "alias +capMot_prsforward +capMot_mvforward;alias -capMot_prsforward -capMot_mvforward;alias +capMot_prsback +capMot_mvback;alias -capMot_prsback -capMot_mvback"
alias capMot_mvrev_off_rl "alias +capMot_prsright +capMot_mvright;alias -capMot_prsright -capMot_mvright;alias +capMot_prsleft +capMot_mvleft;alias -capMot_prsleft -capMot_mvleft"
alias capMot_mvrev_on_fb "alias +capMot_prsforward +capMot_mvback;alias -capMot_prsforward -capMot_mvback;alias +capMot_prsback +capMot_mvforward;alias -capMot_prsback -capMot_mvforward"
alias capMot_mvrev_on_rl "alias +capMot_prsright +capMot_mvleft;alias -capMot_prsright -capMot_mvleft;alias +capMot_prsleft +capMot_mvright;alias -capMot_prsleft -capMot_mvright"
alias capMot_mvrev_on_2off "capMot_moveTF_fb_revsta;capMot_moveTF_rl_revsta;capMot_mvrev_off"
alias capMot_mvrev_on "capMot_mvrev_on_fb;capMot_mvrev_on_rl;alias capMot_mvrev capMot_mvrev_on_2off"
alias capMot_mvrev_off_2on "capMot_moveTF_fb_revsta;capMot_moveTF_rl_revsta;capMot_mvrev_on"
alias capMot_mvrev_off "capMot_mvrev_off_fb;capMot_mvrev_off_rl;alias capMot_mvrev capMot_mvrev_off_2on"

alias capMot_reset "exec Horizon/src/modules/capMotion/reset"

capMot_joyfb
capMot_joyrl
capMot_joy_setSpeedFull
-capMot_keyf
-capMot_keyb
-capMot_keyr
-capMot_keyl
    capMot_autostopW_on
    capMot_autostopS_on
    capMot_autostopD_on
    capMot_autostopA_on
capMot_joyTF_fb00
capMot_joyTF_rl00
// capMot_keyTF_fb00
// capMot_keyTF_rl00
capMot_moveTF_sw2joy
capMot_mvrev_off

//debug
alias capMot $capMot_cmd
setinfo capMot 0
alias +capMot_forward "alias $capMot_cmd +capMot_prsforward;incrementvar capMot 0 0 0 | grep ~"
alias -capMot_forward "alias $capMot_cmd -capMot_prsforward;incrementvar capMot 0 0 0 | grep ~"
alias +capMot_back "alias $capMot_cmd +capMot_prsback;incrementvar capMot 0 0 0 | grep ~"
alias -capMot_back "alias $capMot_cmd -capMot_prsback;incrementvar capMot 0 0 0 | grep ~"
alias +capMot_right "alias $capMot_cmd +capMot_prsright;incrementvar capMot 0 0 0 | grep ~"
alias -capMot_right "alias $capMot_cmd -capMot_prsright;incrementvar capMot 0 0 0 | grep ~"
alias +capMot_left "alias $capMot_cmd +capMot_prsleft;incrementvar capMot 0 0 0 | grep ~"
alias -capMot_left "alias $capMot_cmd -capMot_prsleft;incrementvar capMot 0 0 0 | grep ~"
bind w +capMot_forward
bind s +capMot_back
bind d +capMot_right
bind a +capMot_left
cl_allow_multi_input_binds 0
alias open_buymenu "cl_allow_multi_input_binds 1;capMot_moveTF_sw2key;cl_allow_multi_input_binds 0"
alias close_buymenu "cl_allow_multi_input_binds 1;capMot_moveTF_sw2joy;cl_allow_multi_input_binds 0"
alias capMot_tmp "capMot_mvrev;alias capMotTicker_tmp"
bind j "alias capMotTicker_tmp capMot_tmp"